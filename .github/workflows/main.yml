name: Metrics

on:
  # Daily scheduled run (00:00 UTC)
  schedule:
    - cron: "0 0 * * *"

  # Manual trigger
  workflow_dispatch:

  # Run on push to main branches
  push:
    branches:
      - main
      - master

jobs:
  github-metrics:
    name: Generate GitHub Metrics
    runs-on: ubuntu-latest

    environment:
      name: production

    permissions:
      contents: write

    steps:
      # ------------------------------------------------------------
      # ðŸŸ¢ Overview
      # ------------------------------------------------------------
      - name: Overview
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.METRICS_TOKEN }}

      # ------------------------------------------------------------
      # ðŸŸ¢ Isometric Contribution Calendar
      # ------------------------------------------------------------
      - name: Isometric Calendar
        uses: lowlighter/metrics@latest
        with:
          filename: metrics.plugin.isocalendar.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_isocalendar: yes

      # ------------------------------------------------------------
      # ðŸŸ¢ Recent Activity
      # ------------------------------------------------------------
      - name: Recent Activity
        uses: lowlighter/metrics@latest
        with:
          filename: metrics.plugin.activity.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_activity: yes
          plugin_activity_limit: 5
          plugin_activity_days: 0
          plugin_activity_filter: issue, pr, release, fork, review, ref/create

      # ------------------------------------------------------------
      # ðŸŸ¢ Languages (In-depth Analysis)
      # ------------------------------------------------------------
      - name: Languages Analysis
        uses: lowlighter/metrics@latest
        with:
          filename: metrics.plugin.languages.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_languages: yes
          plugin_languages_indepth: yes
          commits_authoring: firstname lastname, username, username@users.noreply.github.com

      # ------------------------------------------------------------
      # ðŸŸ¢ Topics (Icons Mode)
      # ------------------------------------------------------------
      - name: Topics (Icons)
        uses: lowlighter/metrics@latest
        with:
          filename: metrics.plugin.topics.icons.svg
          token: NOT_NEEDED
          base: ""
          plugin_topics: yes
          plugin_topics_limit: 0
          plugin_topics_mode: icons

      # ------------------------------------------------------------
      # ðŸŸ¢ Achievements (Compact Mode)
      # ------------------------------------------------------------
      - name: Achievements (Compact)
        uses: lowlighter/metrics@latest
        with:
          filename: metrics.plugin.achievements.compact.svg
          token: ${{ secrets.METRICS_TOKEN }}
          base: ""
          plugin_achievements: yes
          plugin_achievements_only: >
            polyglot, stargazer, sponsor, deployer, member,
            maintainer, developer, scripter, packager,
            explorer, infographile, manager
          plugin_achievements_display: compact
          plugin_achievements_threshold: X

      # ------------------------------------------------------------
      # ðŸŸ¢ Apple Music â€“ Random Track from Playlist
      # ------------------------------------------------------------
      - name: Apple Music (Random Playlist Track)
        uses: lowlighter/metrics@latest
        with:
          filename: metrics.plugin.music.playlist.svg
          token: NOT_NEEDED
          base: ""
          plugin_music: yes
          plugin_music_playlist: https://embed.music.apple.com/us/playlist/favorite-songs/pl.u-7jUvpGY61q
          plugin_music_limit: 2
